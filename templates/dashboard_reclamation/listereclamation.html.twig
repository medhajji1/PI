{% extends 'basedashboard.html.twig' %}

{% block title %}Liste De Reclamation{% endblock %}

{% block body %} 
    <div class="layout-page">
          <!-- Navbar -->

          <nav
            class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
            id="layout-navbar"
          >
            <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
              <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
                <i class="bx bx-menu bx-sm"></i>
              </a>
            </div>
            <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
              <!-- Search -->
              <div class="nav-item d-flex align-items-center">
                <label for="search-input" class="me-2"></label>
                <input
                    type="text"
                    class="form-control border-0 shadow-none"
                    placeholder="Search..."
                    aria-label="Search..."
                    id="search-input"
                />               
                </div>
                
              <!-- /Search -->

              <ul class="navbar-nav flex-row align-items-center ms-auto">
                <!-- Place this tag where you want the button to render. -->
                <li class="nav-item lh-1 me-3">
                  <a class="github-button"href="https://github.com/themeselection/sneat-html-admin-template-free"data-icon="octicon-star"data-size="large"data-show-count="true"aria-label="Star themeselection/sneat-html-admin-template-free on GitHub">Star</a
                  >
                </li>
                <!-- User -->
                <li class="nav-item navbar-dropdown dropdown-user dropdown">
                  <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                    <div class="avatar avatar-online">
                      <img src="{{ asset('back/assets/img/avatars/1.jpg') }}" alt class="w-px-40 h-auto rounded-circle" />
                    </div>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                      <a class="dropdown-item" href="#">
                        <div class="d-flex">
                          <div class="flex-shrink-0 me-3">
                            <div class="avatar avatar-online">
                              <img src="{{ asset('back/assets/img/avatars/1.jpg') }}" alt class="w-px-40 h-auto rounded-circle" />
                            </div>
                          </div>
                          <div class="flex-grow-1">
                            <span class="fw-semibold d-block">John Doe</span>
                            <small class="text-muted">Admin</small>
                          </div>
                        </div>
                      </a>
                    </li>
                    <li>
                      <div class="dropdown-divider"></div>
                    </li>
                    <li>
                      <a class="dropdown-item" href="#">
                        <i class="bx bx-user me-2"></i>
                        <span class="align-middle">My Profile</span>
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="#">
                        <i class="bx bx-cog me-2"></i>
                        <span class="align-middle">Settings</span>
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="#">
                        <span class="d-flex align-items-center align-middle">
                          <i class="flex-shrink-0 bx bx-credit-card me-2"></i>
                          <span class="flex-grow-1 align-middle">Billing</span>
                          <span class="flex-shrink-0 badge badge-center rounded-pill bg-danger w-px-20 h-px-20">4</span>
                        </span>
                      </a>
                    </li>
                    <li>
                      <div class="dropdown-divider"></div>
                    </li>
                    <li>
                      <a class="dropdown-item" href="auth-login-basic.html">
                        <i class="bx bx-power-off me-2"></i>
                        <span class="align-middle">Log Out</span>
                      </a>
                    </li>
                  </ul>
                </li>
                <!--/ User -->
              </ul>
            </div>
          </nav>
          <div class="content-wrapper">
          <div class="container-xxl flex-grow-1 container-p-y">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Liste De Reclamation</h3>
            <a id="filter-open" class="badge bg-label-primary me-1" href="{{ path('app_dashboard_reclamation', {'filter': 'open'}) }}">OPEN</a>
            <a id="filter-inprogress" class="badge bg-label-info me-1" href="{{ path('app_dashboard_reclamation', {'filter': 'inprogress'}) }}">INPROGRESS</a>
            <a id="filter-new" class="badge bg-label-warning me-1" href="{{ path('app_dashboard_reclamation', {'filter': 'new'}) }}">NEW</a>
            <a id="filter-resolved" class="badge bg-label-success me-1" href="{{ path('app_dashboard_reclamation', {'filter': 'resolved'}) }}">Resolved</a>
            
        </div>
        <div class="card-body">
            <div class="table-responsive" >
                <table  class="table table-hover table-sm table-responsive-md" style="margin-bottom: 200px;">
                    <thead>
                        <tr class="reclamation-roww">
                            <th>Nom</th>
                            <th>Email</th>
                            <th>Sujet</th>
                            <th>Message</th>
                            <th>Téléphone</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Catégorie</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody class="table-border-bottom-0">
                        {% for reclamation in reclamations %}
                            <tr class="reclamation-row">
                                <td>{{ reclamation.nom }}</td>
                                <td>{{ reclamation.email }}</td>
                                <td>{{ reclamation.sujet }}</td>
                                <td>{{ reclamation.message }}</td>
                                <td>{{ reclamation.numtel }}</td>
                                <td>{{ reclamation.status }}</td>
                                <td>{{ reclamation.datesubmitted|date('Y-m-d') }}</td>
                                <td>{{ reclamation.category }}</td>
                                <td>
                         <div class="dropdown">
                            <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown" aria-expanded="false">
                              <i class="bx bx-dots-vertical-rounded"></i>
                            </button>
                            <div class="dropdown-menu">
                              <a class="dropdown-item" href="{{ path('app_dashboard_reclamation_edit', {'id': reclamation.id}) }}" class="dropdown-item edit-btn"><i class="bx bx-edit-alt me-1"></i> Edit</a>
                              <a class="dropdown-item" href="{{ path('app_dashboard_reclamation_delete', {'id': reclamation.id}) }}" class="dropdown-item delete-btn"><i class="bx bx-trash me-1"></i> Delete</a>
                              <a class="dropdown-item" href="{{ path('app_dashboard_reclamation_reponse', {'id': reclamation.id}) }}" class="dropdown-item delete-btn"><i class="bx bx-trash me-1"></i> Reponder</a>
                            </div>
                          </div>
                          </div>
                           </td>    
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
 </div>
            <div class="content-backdrop fade"></div>
          </div>
        </div>
      </div>
      <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
$('#search-input').on('keyup', function() {
  var searchTerm = $(this).val();
  $.ajax({
    url: '/search',
    type: 'GET',
    data: { q: searchTerm },
    success: function(data) {
      var tableRows = '';
      data.forEach(function(reclamation) {
        tableRows += '<tr><td>' + reclamation.nom + '</td><td>' + reclamation.email + '</td><td>' + reclamation.sujet + '</td><td>' + reclamation.message + '</td><td>' + reclamation.numtel + '</td><td>' + reclamation.status + '</td><td>' + reclamation.datesubmitted + '</td><td>' + reclamation.category + '</td></tr>';
      });
      $('table tbody').html(tableRows);
    }
  });
});
</script>
{% endblock %}